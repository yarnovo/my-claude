---
name: worktree
description: Git Worktree ç®¡ç†ï¼ˆæ”¯æŒåˆ†æ”¯åæˆ–åŠŸèƒ½æè¿°ï¼‰
allowed-tools: Bash, Read, Write
---

è¯·å¸®æˆ‘ç®¡ç† git worktreeï¼š

## å‚æ•°

$ARGUMENTS

## æ„å›¾è¯†åˆ«

æ ¹æ®å‚æ•°åˆ¤æ–­ç”¨æˆ·æ„å›¾ï¼š

| æ„å›¾ | è§¦å‘è¯ç¤ºä¾‹ |
|------|-----------|
| **åˆ—è¡¨** | ç©ºå‚æ•°ã€`list`ã€`åˆ—è¡¨`ã€`æœ‰å“ªäº›`ã€`çŠ¶æ€` |
| **åˆ é™¤** | `åˆ é™¤ xxx`ã€`ç§»é™¤ xxx`ã€`remove xxx`ã€`-d xxx`ã€`å¹²æ‰ xxx` |
| **åŒæ­¥æ£€æŸ¥** | `æ£€æŸ¥`ã€`åŒæ­¥çŠ¶æ€`ã€`è½å`ã€`check` |
| **æ¸…ç†** | `æ¸…ç†`ã€`prune`ã€`æ¸…ç†æ— æ•ˆ` |
| **åˆ›å»º** | å…¶ä»–æƒ…å†µï¼ˆåˆ†æ”¯åæˆ–åŠŸèƒ½æè¿°ï¼‰ |

## æ‰§è¡Œæ­¥éª¤

### åˆ—è¡¨ï¼ˆæ— å‚æ•°æˆ–æ˜ç¡®è¯·æ±‚ï¼‰

```bash
git worktree list
```

è¾“å‡ºæ ¼å¼ï¼š
```
ğŸ“‹ å½“å‰ Worktree åˆ—è¡¨ï¼š

| ç›®å½• | åˆ†æ”¯ | çŠ¶æ€ |
|------|------|------|
| /path/to/repo | main | âœ… å½“å‰ |
| /path/to/repo-feature | feature | ğŸ“ |
```

### åˆ é™¤

1. è§£æè¦åˆ é™¤çš„ worktreeï¼ˆæ”¯æŒï¼šç›®å½•åã€åˆ†æ”¯åã€æ¨¡ç³ŠåŒ¹é…ï¼‰
2. æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤æ›´æ”¹
3. å¦‚æœ‰å¤šä¸ªåŒ¹é…ï¼Œåˆ—å‡ºè®©ç”¨æˆ·é€‰æ‹©
4. **è¯»å–åŸŸåé…ç½®**ï¼ˆåˆ é™¤å‰ï¼‰ï¼š
   ```bash
   cat <path>/.claude/worktree.json  # è·å– domain å­—æ®µ
   ```
5. **æ¸…ç† Caddy é…ç½®**ï¼š
   ```bash
   # ä» ~/.config/caddy/worktrees.caddy åˆ é™¤å¯¹åº”åŸŸåé…ç½®å—
   # åŒ¹é…æ³¨é‡Šè¡Œ "# <branch-name>" åˆ°ä¸‹ä¸€ä¸ªç©ºè¡Œä¹‹é—´çš„å†…å®¹
   sed -i '' '/^# <branch-name>$/,/^$/d' ~/.config/caddy/worktrees.caddy

   # é‡è½½ Caddy
   caddy reload --config /opt/homebrew/etc/Caddyfile
   ```
6. æ‰§è¡Œåˆ é™¤ï¼š
   ```bash
   git worktree remove <path>
   ```

è¾“å‡ºæ ¼å¼ï¼š
```
âœ… Worktree å·²åˆ é™¤ï¼

ğŸ“ ç›®å½•: /path/to/repo-branchï¼ˆå·²åˆ é™¤ï¼‰
ğŸŒ¿ åˆ†æ”¯: branch-nameï¼ˆä¿ç•™ï¼‰
ğŸŒ Caddy é…ç½®å·²æ¸…ç†
```

### åŒæ­¥æ£€æŸ¥

æ£€æŸ¥æ‰€æœ‰ worktree çš„è¿œç¨‹åŒæ­¥çŠ¶æ€ï¼š

```bash
git fetch --all
# å¯¹æ¯ä¸ª worktree æ£€æŸ¥ ahead/behind
```

è¾“å‡ºæ ¼å¼ï¼š
```
ğŸ“Š Worktree åŒæ­¥çŠ¶æ€ï¼š

| ç›®å½• | åˆ†æ”¯ | çŠ¶æ€ |
|------|------|------|
| loan | next | âœ… å·²åŒæ­¥ |
| loan-main | main | âš ï¸ è½å 5 ä¸ªæäº¤ |
```

### æ¸…ç†

æ¸…ç†æ— æ•ˆçš„ worktree å¼•ç”¨ï¼š

```bash
git worktree prune
```

### åˆ›å»ºï¼ˆé»˜è®¤ï¼‰

1. **è§£æå‚æ•°**ï¼š
   - å¦‚æœæ˜¯è‹±æ–‡ä¸”ç¬¦åˆåˆ†æ”¯å‘½åï¼ˆå°å†™ã€æ•°å­—ã€`-`ã€`/`ï¼‰ï¼Œç›´æ¥ä½œä¸ºåˆ†æ”¯å
   - å¦‚æœæ˜¯ä¸­æ–‡æè¿°ï¼Œç”Ÿæˆåˆé€‚çš„è‹±æ–‡åˆ†æ”¯åï¼ˆkebab-caseï¼‰
   - æ·»åŠ æ—¥æœŸå‰ç¼€ï¼š`<å½“å‰åˆ†æ”¯>-<åˆ†æ”¯å>-<YYYYMMDD>`

2. **æ£€æŸ¥åˆ†æ”¯çŠ¶æ€**ï¼š
   ```bash
   git show-ref --verify --quiet refs/heads/<branch-name>
   ```

3. **åˆ›å»º worktree**ï¼š
   - ç›®å½•ä½ç½®ï¼š`../<ä»“åº“å>-<åˆ†æ”¯å>`
   - åˆ†æ”¯ä¸å­˜åœ¨ï¼š`git worktree add -b <branch> <path>`
   - åˆ†æ”¯å·²å­˜åœ¨ï¼š`git worktree add <path> <branch>`

4. **æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬**ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼š
   ```bash
   # æ£€æŸ¥æ–° worktree ç›®å½•ä¸‹æ˜¯å¦æœ‰åˆå§‹åŒ–è„šæœ¬
   if [ -x <path>/.claude/worktree-init.sh ]; then
     cd <path> && ./.claude/worktree-init.sh
   fi
   ```

5. **è¯»å–ç”Ÿæˆçš„ç«¯å£é…ç½®**ï¼š
   ```bash
   # ä»åˆå§‹åŒ–è„šæœ¬ç”Ÿæˆçš„é…ç½®ä¸­è¯»å–ç«¯å£
   cat <path>/.claude/worktree.json
   ```

6. **ç”¨ VS Code æ‰“å¼€**ï¼š
   ```bash
   # ä¼˜å…ˆä½¿ç”¨ code å‘½ä»¤ï¼Œä¸å¯ç”¨æ—¶ fallback åˆ° open
   code <path> 2>/dev/null || open -a "Visual Studio Code" <path>
   ```

è¾“å‡ºæ ¼å¼ï¼š
```
âœ… Worktree åˆ›å»ºæˆåŠŸï¼

ğŸ“ ç›®å½•: /path/to/repo-branch
ğŸŒ¿ åˆ†æ”¯: branch-name
ğŸ“ åŸºäº: current-branch

ğŸ”§ åˆå§‹åŒ–å®Œæˆï¼ŒæœåŠ¡å·²å¯åŠ¨ï¼š
ğŸŒ Next.js:    https://<domain-name>.localhost
ğŸ“– Storybook:  https://<domain-name>-sb.localhost

å·²ç”¨ VS Code æ‰“å¼€æ–°ç›®å½•
```

æ³¨æ„ï¼šåŸŸåä»åˆ†æ”¯åæå–ï¼ˆå»æ‰å‰ç¼€å’Œæ—¥æœŸåç¼€ï¼‰ï¼Œä¾‹å¦‚ `main-loan-consulting-agent-20260102` -> `loan-consulting-agent`

## é”™è¯¯å¤„ç†

- ä¸æ˜¯ git ä»“åº“ â†’ æç¤ºç”¨æˆ·
- åˆ†æ”¯å·²è¢«å…¶ä»– worktree ä½¿ç”¨ â†’ æç¤ºç”¨æˆ·
- ç›®å½•å·²å­˜åœ¨ â†’ æç¤ºç”¨æˆ·
- åˆ é™¤æ—¶æœ‰æœªæäº¤æ›´æ”¹ â†’ è¯¢é—®æ˜¯å¦å¼ºåˆ¶åˆ é™¤
- æ¨¡ç³ŠåŒ¹é…å¤šä¸ªç»“æœ â†’ åˆ—å‡ºé€‰é¡¹è®©ç”¨æˆ·ç¡®è®¤

## ä½¿ç”¨ç¤ºä¾‹

```
/worktree                     # åˆ—å‡ºæ‰€æœ‰ worktree
/worktree ä¿®å¤ç™»å½•bug          # åˆ›å»ºæ–° worktree
/worktree åˆ é™¤ loan-main       # åˆ é™¤æŒ‡å®š worktree
/worktree åˆ é™¤é‚£ä¸ªæ—§çš„ v2      # æ¨¡ç³ŠåŒ¹é…åˆ é™¤
/worktree æ£€æŸ¥åŒæ­¥çŠ¶æ€         # æ£€æŸ¥è¿œç¨‹åŒæ­¥
/worktree æ¸…ç†                 # æ¸…ç†æ— æ•ˆå¼•ç”¨
```
